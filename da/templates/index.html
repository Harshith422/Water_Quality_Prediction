<!DOCTYPE html>
<html>
<head>
    <title>Airline Delay Prediction</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .prediction-result {
            display: none;
            margin-top: 20px;
        }
        .loader {
            display: none;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .connection-status {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">Airline Delay Prediction</h3>
                    </div>
                    <div class="card-body">
                        <!-- Connection Status -->
                        <div class="connection-status">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="mb-1">Server Connection</h5>
                                            <p class="mb-0" id="connectionStatus">
                                                <span class="badge bg-secondary">Checking...</span>
                                            </p>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-primary me-2" id="checkConnectionBtn">
                                                <i class="bi bi-arrow-repeat"></i> Check Connection
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <form id="predictionForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="year" class="form-label">Year:</label>
                                    <input type="number" class="form-control" id="year" name="year" min="2000" max="2030" required value="2023">
                                </div>
                                <div class="col-md-6">
                                    <label for="month" class="form-label">Month:</label>
                                    <select class="form-select" id="month" name="month" required>
                                        <option value="1">January</option>
                                        <option value="2">February</option>
                                        <option value="3">March</option>
                                        <option value="4">April</option>
                                        <option value="5">May</option>
                                        <option value="6">June</option>
                                        <option value="7">July</option>
                                        <option value="8">August</option>
                                        <option value="9">September</option>
                                        <option value="10">October</option>
                                        <option value="11">November</option>
                                        <option value="12">December</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="carrier" class="form-label">Airline Carrier:</label>
                                    <select class="form-select" id="carrier" name="carrier" required>
                                        <option value="AA">American Airlines (AA)</option>
                                        <option value="DL">Delta Air Lines (DL)</option>
                                        <option value="UA">United Airlines (UA)</option>
                                        <option value="WN">Southwest Airlines (WN)</option>
                                        <option value="B6">JetBlue (B6)</option>
                                        <option value="AS">Alaska Airlines (AS)</option>
                                        <option value="NK">Spirit Airlines (NK)</option>
                                        <option value="F9">Frontier Airlines (F9)</option>
                                        <option value="G4">Allegiant Air (G4)</option>
                                        <option value="HA">Hawaiian Airlines (HA)</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="airport" class="form-label">Airport:</label>
                                    <select class="form-select" id="airport" name="airport" required>
                                        <option value="ATL">Atlanta (ATL)</option>
                                        <option value="DFW">Dallas/Fort Worth (DFW)</option>
                                        <option value="DEN">Denver (DEN)</option>
                                        <option value="ORD">Chicago O'Hare (ORD)</option>
                                        <option value="LAX">Los Angeles (LAX)</option>
                                        <option value="JFK">New York JFK (JFK)</option>
                                        <option value="LAS">Las Vegas (LAS)</option>
                                        <option value="MCO">Orlando (MCO)</option>
                                        <option value="MIA">Miami (MIA)</option>
                                        <option value="SEA">Seattle (SEA)</option>
                                        <option value="SFO">San Francisco (SFO)</option>
                                        <option value="CLT">Charlotte (CLT)</option>
                                        <option value="PHX">Phoenix (PHX)</option>
                                        <option value="IAH">Houston (IAH)</option>
                                        <option value="BOS">Boston (BOS)</option>
                                        <option value="EWR">Newark (EWR)</option>
                                        <option value="MSP">Minneapolis (MSP)</option>
                                        <option value="DTW">Detroit (DTW)</option>
                                        <option value="PHL">Philadelphia (PHL)</option>
                                        <option value="LGA">New York LaGuardia (LGA)</option>
                                        <option value="FLL">Fort Lauderdale (FLL)</option>
                                        <option value="BWI">Baltimore (BWI)</option>
                                        <option value="DCA">Washington Reagan (DCA)</option>
                                        <option value="SLC">Salt Lake City (SLC)</option>
                                        <option value="SAN">San Diego (SAN)</option>
                                        <option value="TPA">Tampa (TPA)</option>
                                        <option value="PDX">Portland (PDX)</option>
                                        <option value="HNL">Honolulu (HNL)</option>
                                        <option value="AUS">Austin (AUS)</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="arr_flights" class="form-label">Number of Arrival Flights:</label>
                                    <input type="number" class="form-control" id="arr_flights" name="arr_flights" min="1" required value="100">
                                </div>
                                <div class="col-md-6">
                                    <label for="arr_del15" class="form-label">Number of Delayed Flights:</label>
                                    <input type="number" class="form-control" id="arr_del15" name="arr_del15" min="0" required value="20">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="carrier_ct" class="form-label">Carrier-Caused Delays:</label>
                                    <input type="number" class="form-control" id="carrier_ct" name="carrier_ct" min="0" required value="5">
                                </div>
                                <div class="col-md-6">
                                    <label for="weather_ct" class="form-label">Weather-Caused Delays:</label>
                                    <input type="number" class="form-control" id="weather_ct" name="weather_ct" min="0" required value="3">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="nas_ct" class="form-label">NAS-Caused Delays:</label>
                                    <input type="number" class="form-control" id="nas_ct" name="nas_ct" min="0" required value="7">
                                </div>
                                <div class="col-md-6">
                                    <label for="late_aircraft_ct" class="form-label">Late Aircraft Delays:</label>
                                    <input type="number" class="form-control" id="late_aircraft_ct" name="late_aircraft_ct" min="0" required value="5">
                                </div>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary" id="predictBtn">Predict Delay</button>
                            </div>
                        </form>
                        
                        <div class="loader" id="loader"></div>
                        
                        <div class="prediction-result card" id="predictionResult">
                            <div class="card-header">
                                <h4 class="mb-0">Prediction Result</h4>
                            </div>
                            <div class="card-body">
                                <div id="resultContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check server connection when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
        });
        
        // Health check function
        function checkConnection() {
            document.getElementById('connectionStatus').innerHTML = 
                '<span class="badge bg-secondary">Checking...</span>';
            
            fetch('/health')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Server not responding');
                })
                .then(data => {
                    document.getElementById('connectionStatus').innerHTML = 
                        '<span class="badge bg-success">Connected</span>';
                    document.getElementById('predictBtn').disabled = false;
                })
                .catch(error => {
                    document.getElementById('connectionStatus').innerHTML = 
                        '<span class="badge bg-danger">Not Connected: ' + error.message + '</span>';
                    document.getElementById('predictBtn').disabled = true;
                });
        }
        
        // Connection check button
        document.getElementById('checkConnectionBtn').addEventListener('click', function() {
            checkConnection();
        });
        
        // Prediction form submission
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loader
            document.getElementById('loader').style.display = 'block';
            document.getElementById('predictionResult').style.display = 'none';
            
            // Create form data
            const formData = new FormData(this);
            
            // Send data to backend
            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Hide loader
                document.getElementById('loader').style.display = 'none';
                
                // Show result
                const resultDiv = document.getElementById('resultContent');
                
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">
                        <h5><i class="bi bi-exclamation-triangle-fill"></i> Error</h5>
                        <p>${data.error}</p>
                        <p class="mt-2">Possible issues:</p>
                        <ul>
                            <li>AWS credentials not set properly</li>
                            <li>No access to S3 bucket</li>
                            <li>Java/PySpark configuration issue</li>
                        </ul>
                        <p>Check the server logs for more details.</p>
                    </div>`;
                } else {
                    let resultHtml = '';
                    if (data.is_likely_delayed) {
                        resultHtml += `<div class="alert alert-danger">
                            <h5><i class="bi bi-exclamation-triangle-fill"></i> High Risk of Delays</h5>
                            <p>The model predicts that more than 25% of flights will be delayed.</p>
                        </div>`;
                    } else {
                        resultHtml += `<div class="alert alert-success">
                            <h5><i class="bi bi-check-circle-fill"></i> Low Risk of Delays</h5>
                            <p>The model predicts that less than 25% of flights will be delayed.</p>
                        </div>`;
                    }
                    
                    resultHtml += `<div class="mt-3">
                        <p><strong>Delay Probability:</strong> ${(data.delay_probability * 100).toFixed(2)}%</p>
                    </div>`;
                    
                    resultDiv.innerHTML = resultHtml;
                }
                
                document.getElementById('predictionResult').style.display = 'block';
            })
            .catch(error => {
                // Hide loader
                document.getElementById('loader').style.display = 'none';
                
                // Show error
                const resultDiv = document.getElementById('resultContent');
                resultDiv.innerHTML = `<div class="alert alert-danger">
                    <h5><i class="bi bi-exclamation-triangle-fill"></i> Connection Error</h5>
                    <p>An error occurred: ${error.message}</p>
                    <p>The server may not be responding. Please try again later.</p>
                </div>`;
                document.getElementById('predictionResult').style.display = 'block';
            });
        });
    </script>
</body>
</html> 